<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片字幕生成器</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: #333; }
.container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center; }
header h1 { font-size: 2.5em; margin-bottom: 10px; font-weight: 700; }
.subtitle { font-size: 1.1em; opacity: 0.9; }
.upload-section { padding: 40px; }
.upload-box, .text-input-box { margin-bottom: 30px; }
.upload-box h2, .text-input-box h2 { font-size: 1.3em; margin-bottom: 15px; color: #333; font-weight: 600; }
.image-upload-area { border: 3px dashed #667eea; border-radius: 12px; padding: 40px; text-align: center; background: #f8f9ff; cursor: pointer; transition: all 0.3s ease; min-height: 200px; display: flex; align-items: center; justify-content: center; }
.image-upload-area:hover { border-color: #764ba2; background: #f0f2ff; }
.image-upload-area.dragover { border-color: #764ba2; background: #e8ebff; transform: scale(1.02); }
.upload-placeholder { display: flex; flex-direction: column; align-items: center; gap: 15px; }
.upload-placeholder svg { color: #667eea; }
.upload-placeholder p { font-size: 1.1em; color: #666; margin: 0; }
.upload-placeholder .hint { font-size: 0.9em; color: #999; }
.image-preview { max-width: 100%; max-height: 400px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); object-fit: contain; }
textarea { width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; font-family: inherit; resize: vertical; transition: border-color 0.3s ease; line-height: 1.6; }
textarea:focus { outline: none; border-color: #667eea; }
.text-info { margin-top: 10px; color: #666; font-size: 0.9em; }
.generate-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 1.2em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px; }
.generate-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(102,126,234,0.4); }
.generate-btn:disabled { opacity: 0.5; cursor: not-allowed; }
.btn-loading { display: flex; align-items: center; gap: 10px; }
.spinner { width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }
.result-section { padding: 40px; background: #f8f9ff; border-top: 2px solid #e0e0e0; }
.result-section h2 { font-size: 1.5em; margin-bottom: 20px; color: #333; }
.result-actions { margin-bottom: 30px; }
.download-btn { padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
.download-btn:hover { background: #218838; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(40,167,69,0.3); }
.result-container { display: flex; justify-content: center; align-items: center; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.result-image { max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); }
.error-message { padding: 15px; background: #f8d7da; color: #721c24; border-radius: 8px; margin-top: 15px; border: 1px solid #f5c6cb; }
@media (max-width: 768px) { body { padding: 10px; } header { padding: 30px 20px; } header h1 { font-size: 2em; } .upload-section, .result-section { padding: 20px; } .image-upload-area { padding: 30px 20px; min-height: 150px; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>图片字幕生成器</h1>
            <p class="subtitle">上传图片和多行文本，生成一张带叠加字幕的合成图片</p>
        </header>
        <div class="upload-section">
            <div class="upload-box">
                <h2>1. 上传图片</h2>
                <div class="image-upload-area" id="imageUploadArea">
                    <input type="file" id="imageInput" accept="image/*" hidden>
                    <div class="upload-placeholder">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                        <p>点击或拖拽图片到此处上传</p>
                        <p class="hint">支持 JPG, PNG, GIF, WebP (最大 10MB)</p>
                    </div>
                    <img id="imagePreview" class="image-preview" style="display:none" alt="预览">
                </div>
            </div>
            <div class="text-input-box">
                <h2>2. 输入文本（每行一个字幕）</h2>
                <textarea id="textInput" placeholder="请输入文本，每行一个字幕&#10;例如：&#10;第一行字幕&#10;第二行字幕" rows="8"></textarea>
                <div class="text-info"><span id="lineCount">0 行文本</span></div>
            </div>
            <button id="generateBtn" class="generate-btn" disabled>
                <span class="btn-text">生成图片</span>
                <span class="btn-loading" style="display:none"><span class="spinner"></span>生成中...</span>
            </button>
        </div>
        <div class="result-section" id="resultSection" style="display:none">
            <h2>生成结果</h2>
            <div class="result-actions"><button id="downloadBtn" class="download-btn">下载合成图片</button></div>
            <div class="result-container" id="resultContainer"></div>
        </div>
    </div>
    <script>
(function(){
var uploadedImage=null,generatedImageDataUrl=null;
var imageInput=document.getElementById('imageInput'),imageUploadArea=document.getElementById('imageUploadArea'),imagePreview=document.getElementById('imagePreview');
var uploadPlaceholder=imageUploadArea.querySelector('.upload-placeholder');
var textInput=document.getElementById('textInput'),lineCount=document.getElementById('lineCount'),generateBtn=document.getElementById('generateBtn');
var resultSection=document.getElementById('resultSection'),resultContainer=document.getElementById('resultContainer'),downloadBtn=document.getElementById('downloadBtn');
imageUploadArea.onclick=function(){imageInput.click();};
imageInput.onchange=function(e){var f=e.target.files[0];if(f)processImageFile(f);};
imageUploadArea.ondragover=function(e){e.preventDefault();imageUploadArea.classList.add('dragover');};
imageUploadArea.ondragleave=function(e){e.preventDefault();imageUploadArea.classList.remove('dragover');};
imageUploadArea.ondrop=function(e){e.preventDefault();imageUploadArea.classList.remove('dragover');var f=e.dataTransfer.files[0];if(f&&f.type.startsWith('image/'))processImageFile(f);else showError('请上传图片文件');};
textInput.oninput=function(){var lines=textInput.value.split('\n').filter(function(l){return l.trim().length>0;});lineCount.textContent=lines.length+' 行文本';updateGenerateButton();};
generateBtn.onclick=generateImage;
downloadBtn.onclick=downloadImage;
function processImageFile(file){if(file.size>10*1024*1024){showError('图片大小不能超过 10MB');return;}
var r=new FileReader();r.onload=function(e){uploadedImage=new Image();uploadedImage.onload=function(){imagePreview.src=e.target.result;imagePreview.style.display='block';uploadPlaceholder.style.display='none';updateGenerateButton();};uploadedImage.src=e.target.result;};r.readAsDataURL(file);}
function updateGenerateButton(){var hasImage=uploadedImage!==null,hasText=textInput.value.trim().length>0;generateBtn.disabled=!(hasImage&&hasText);}
function generateImage(){if(!uploadedImage){showError('请先上传图片');return;}
var textLines=textInput.value.split('\n').filter(function(l){return l.trim().length>0;});if(textLines.length===0){showError('请输入至少一行文本');return;}
generateBtn.disabled=true;generateBtn.querySelector('.btn-text').style.display='none';generateBtn.querySelector('.btn-loading').style.display='flex';
setTimeout(function(){try{var canvas=createCompositeImage(uploadedImage,textLines);generatedImageDataUrl=canvas.toDataURL('image/png');displayResult(generatedImageDataUrl);}catch(err){showError('生成图片失败，请重试');}
generateBtn.disabled=false;generateBtn.querySelector('.btn-text').style.display='block';generateBtn.querySelector('.btn-loading').style.display='none';},100);}
function createCompositeImage(image,textLines){var w=image.width,h=image.height,sh=Math.max(60,Math.floor(h/8)),pad=20;
var canvas=document.createElement('canvas');canvas.width=w;canvas.height=h+textLines.length*sh;var ctx=canvas.getContext('2d');
ctx.drawImage(image,0,0,w,h);
for(var i=0;i<textLines.length;i++){var y=(i===0)?h-sh:h+(i-1)*sh;var sy=Math.max(0,h-sh),sH=Math.min(sh,h);ctx.drawImage(image,0,sy,w,sH,0,y,w,sh);ctx.fillStyle='rgba(0,0,0,0.6)';ctx.fillRect(0,y,w,sh);ctx.fillStyle='white';ctx.font='bold '+Math.max(20,Math.floor(sh*0.3))+'px "Microsoft YaHei",Arial,sans-serif';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(textLines[i],w/2,y+sh/2);}
return canvas;}
function displayResult(url){resultContainer.innerHTML='';var img=document.createElement('img');img.src=url;img.className='result-image';img.alt='生成的合成图片';resultContainer.appendChild(img);resultSection.style.display='block';resultSection.scrollIntoView({behavior:'smooth',block:'nearest'});}
function downloadImage(){if(!generatedImageDataUrl){showError('没有可下载的图片');return;}var a=document.createElement('a');a.download='字幕图片_'+Date.now()+'.png';a.href=generatedImageDataUrl;a.click();}
function showError(msg){var old=document.querySelector('.error-message');if(old)old.remove();var d=document.createElement('div');d.className='error-message';d.textContent=msg;imageUploadArea.parentElement.appendChild(d);setTimeout(function(){d.remove();},3000);}
})();
    </script>
</body>
</html>
